2023-06-22 12:44:35.505 +03:00 [ERR] An error occurred using the connection to database 'ExpenseMaster' on server '.\SQLEXPRESS'.
2023-06-22 12:44:35.641 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
System.InvalidOperationException: An exception has been raised that is likely due to a transient failure. Consider enabling transient error resiliency by adding 'EnableRetryOnFailure' to the 'UseSqlServer' call.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Не удается открыть базу данных "ExpenseMaster", запрашиваемую именем входа. Не удалось выполнить вход.
При входе в систему пользователя "DESKTOP-VT57MSN\ilyad" произошла ошибка.
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.CompleteLogin(Boolean enlistOK)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
ClientConnectionId:1f99636c-ec9d-424b-b5f0-c086f3023046
Error Number:4060,State:1,Class:11
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
System.InvalidOperationException: An exception has been raised that is likely due to a transient failure. Consider enabling transient error resiliency by adding 'EnableRetryOnFailure' to the 'UseSqlServer' call.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Не удается открыть базу данных "ExpenseMaster", запрашиваемую именем входа. Не удалось выполнить вход.
При входе в систему пользователя "DESKTOP-VT57MSN\ilyad" произошла ошибка.
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.CompleteLogin(Boolean enlistOK)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.AttemptOneLogin(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean ignoreSniOpenTimeout, TimeoutTimer timeout, Boolean withFailover)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.LoginNoFailover(ServerInfo serverInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString connectionOptions, SqlCredential credential, TimeoutTimer timeout)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds.OpenLoginEnlist(TimeoutTimer timeout, SqlConnectionString connectionOptions, SqlCredential credential, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance)
   at Microsoft.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, Boolean applyTransientFaultHandling, String accessToken, DbConnectionPool pool)
   at Microsoft.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
   at Microsoft.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal& connection)
   at Microsoft.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
   at Microsoft.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry, SqlConnectionOverrides overrides)
   at Microsoft.Data.SqlClient.SqlConnection.Open(SqlConnectionOverrides overrides)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.OpenInternal(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Open(Boolean errorsExpected)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.InitializeReader(Enumerator enumerator)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
ClientConnectionId:1f99636c-ec9d-424b-b5f0-c086f3023046
Error Number:4060,State:1,Class:11
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.Enumerator.MoveNext()
2023-06-22 13:16:10.634 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 13:16:10.738 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 13:16:10.744 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 13:16:10.979 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 13:16:10.980 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 13:16:10.986 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 13:16:10.987 +03:00 [INF] Hosting environment: Development
2023-06-22 13:16:10.988 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 13:16:11.612 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 13:16:12.146 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 542.7495ms
2023-06-22 13:16:12.541 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 13:16:12.541 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 13:16:12.558 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 16.3891ms
2023-06-22 13:16:12.645 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 104.1680ms
2023-06-22 13:16:13.096 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 13:16:13.351 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 254.7652ms
2023-06-22 13:16:18.389 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses - -
2023-06-22 13:16:18.402 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.GetExpenses (ExpenseMaster)'
2023-06-22 13:16:18.428 +03:00 [INF] Route matched with {action = "GetExpenses", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]]] GetExpenses() on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 13:16:18.674 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [e].[Id], [e].[Amount], [e].[CategoryId], [e].[Date], [e].[UserId]
FROM [Expenses] AS [e]
2023-06-22 13:16:18.695 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto, ExpenseMaster.BusinessLogic, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2023-06-22 13:16:18.740 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.GetExpenses (ExpenseMaster) in 299.1692ms
2023-06-22 13:16:18.743 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.GetExpenses (ExpenseMaster)'
2023-06-22 13:16:18.757 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses - - - 200 - application/json;+charset=utf-8 368.6003ms
2023-06-22 13:20:49.066 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 13:20:49.169 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 13:20:49.174 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 13:20:49.387 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 13:20:49.388 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 13:20:49.394 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 13:20:49.395 +03:00 [INF] Hosting environment: Development
2023-06-22 13:20:49.397 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 13:20:50.341 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 13:20:50.840 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 503.2100ms
2023-06-22 13:20:51.275 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 13:20:51.275 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 13:20:51.296 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 20.8968ms
2023-06-22 13:20:51.389 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 114.3382ms
2023-06-22 13:20:51.810 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 13:20:52.067 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 256.5246ms
2023-06-22 13:20:57.056 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses - -
2023-06-22 13:20:57.069 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.GetExpenses (ExpenseMaster)'
2023-06-22 13:20:57.094 +03:00 [INF] Route matched with {action = "GetExpenses", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]]] GetExpenses() on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 13:20:57.364 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [e].[Id], [e].[Amount], [e].[CategoryId], [e].[Date], [e].[UserId]
FROM [Expenses] AS [e]
2023-06-22 13:20:57.384 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto, ExpenseMaster.BusinessLogic, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2023-06-22 13:20:57.427 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.GetExpenses (ExpenseMaster) in 322.9202ms
2023-06-22 13:20:57.432 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.GetExpenses (ExpenseMaster)'
2023-06-22 13:20:57.448 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses - - - 200 - application/json;+charset=utf-8 391.7640ms
2023-06-22 16:21:52.004 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:21:52.101 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:21:52.108 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:21:52.354 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 16:21:52.354 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 16:21:52.360 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 16:21:52.362 +03:00 [INF] Hosting environment: Development
2023-06-22 16:21:52.362 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 16:21:53.412 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger - -
2023-06-22 16:21:53.546 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger - - - 301 0 - 136.8425ms
2023-06-22 16:21:53.570 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 16:21:53.966 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 395.1086ms
2023-06-22 16:21:54.314 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/swagger-ui.css - -
2023-06-22 16:21:54.314 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 16:21:54.314 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/swagger-ui-standalone-preset.js - -
2023-06-22 16:21:54.314 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/swagger-ui-bundle.js - -
2023-06-22 16:21:54.321 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 16:21:54.341 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 27.4728ms
2023-06-22 16:21:54.387 +03:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2023-06-22 16:21:54.427 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/swagger-ui.css - - - 200 143632 text/css 113.8305ms
2023-06-22 16:21:54.455 +03:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2023-06-22 16:21:54.460 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/swagger-ui-standalone-preset.js - - - 200 337162 application/javascript 146.9130ms
2023-06-22 16:21:54.544 +03:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2023-06-22 16:21:54.548 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 227.0148ms
2023-06-22 16:21:54.555 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/swagger-ui-bundle.js - - - 200 1092889 application/javascript 241.5843ms
2023-06-22 16:21:54.930 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/favicon-32x32.png - -
2023-06-22 16:21:54.931 +03:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2023-06-22 16:21:54.933 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/favicon-32x32.png - - - 200 628 image/png 3.1624ms
2023-06-22 16:21:55.038 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 16:21:55.226 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 187.7383ms
2023-06-22 16:22:02.877 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Profile - -
2023-06-22 16:22:02.890 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2023-06-22 16:22:02.901 +03:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: No authenticationScheme was specified, and there was no DefaultChallengeScheme found. The default schemes can be set using either AddAuthentication(string defaultScheme) or AddAuthentication(Action<AuthenticationOptions> configureOptions).
   at Microsoft.AspNetCore.Authentication.AuthenticationService.ChallengeAsync(HttpContext context, String scheme, AuthenticationProperties properties)
   at Microsoft.AspNetCore.Authorization.Policy.AuthorizationMiddlewareResultHandler.HandleAsync(RequestDelegate next, HttpContext context, AuthorizationPolicy policy, PolicyAuthorizationResult authorizeResult)
   at Microsoft.AspNetCore.Authorization.AuthorizationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2023-06-22 16:22:02.946 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Profile - - - 500 - text/plain;+charset=utf-8 68.9945ms
2023-06-22 16:28:58.476 +03:00 [INF] Executed DbCommand (88ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:28:58.692 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:28:58.698 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:28:58.808 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 16:28:59.282 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 16:28:59.285 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 16:28:59.310 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 16:28:59.316 +03:00 [INF] Hosting environment: Development
2023-06-22 16:28:59.321 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 16:29:00.767 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 16:29:01.842 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 1075.0749ms
2023-06-22 16:29:02.551 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 16:29:02.552 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 16:29:02.567 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 15.1462ms
2023-06-22 16:29:02.859 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 307.8512ms
2023-06-22 16:29:03.583 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 16:29:04.109 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 526.1934ms
2023-06-22 16:29:12.730 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Profile - -
2023-06-22 16:29:13.903 +03:00 [INF] Authorization failed. These requirements were not met:
DenyAnonymousAuthorizationRequirement: Requires an authenticated user.
2023-06-22 16:29:13.920 +03:00 [INF] AuthenticationScheme: Bearer was challenged.
2023-06-22 16:29:13.921 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Profile - - - 401 0 - 1191.3982ms
2023-06-22 16:29:49.098 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 63
2023-06-22 16:29:49.134 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:29:49.226 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:29:49.981 +03:00 [INF] Executed DbCommand (97ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:29:50.203 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2023-06-22 16:29:50.246 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 971.5083ms
2023-06-22 16:29:50.250 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:29:50.269 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 63 - 400 - text/plain;+charset=utf-8 1180.8735ms
2023-06-22 16:30:01.535 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Login application/json 42
2023-06-22 16:30:01.545 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Get (ExpenseMaster)'
2023-06-22 16:30:01.564 +03:00 [INF] Route matched with {action = "Get", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Get(ExpenseMaster.BusinessLogic.Dto.UserLoginDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:30:02.048 +03:00 [ERR] Failed executing DbCommand (90ms) [Parameters=[@__login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[PasswordSalt], [u].[RoleId], [r].[Id], [r].[Name]
FROM [Users] AS [u]
INNER JOIN [Roles] AS [r] ON [u].[RoleId] = [r].[Id]
WHERE [u].[Login] = @__login_0
2023-06-22 16:30:02.197 +03:00 [ERR] An exception occurred while iterating over the results of a query for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Roles'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__208_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__272_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:9b462139-d83d-4b07-9a9a-68950d1a8aaf
Error Number:208,State:1,Class:16
Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid object name 'Roles'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__208_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__272_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.InitializeReaderAsync(AsyncEnumerator enumerator, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Query.Internal.SingleQueryingEnumerable`1.AsyncEnumerator.MoveNextAsync()
ClientConnectionId:9b462139-d83d-4b07-9a9a-68950d1a8aaf
Error Number:208,State:1,Class:16
2023-06-22 16:30:02.534 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2023-06-22 16:30:02.536 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Get (ExpenseMaster) in 961.5352ms
2023-06-22 16:30:02.538 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Get (ExpenseMaster)'
2023-06-22 16:30:02.542 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Login application/json 42 - 400 - text/plain;+charset=utf-8 1008.0090ms
2023-06-22 16:30:59.411 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 62
2023-06-22 16:30:59.414 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:30:59.416 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:30:59.425 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:30:59.648 +03:00 [ERR] Failed executing DbCommand (7ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 20), @p2='?' (Size = 8000) (DbType = Binary), @p3='?' (Size = 8000) (DbType = Binary), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [PasswordSalt], [RoleId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-22 16:30:59.669 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'RoleId'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__208_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__272_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9b462139-d83d-4b07-9a9a-68950d1a8aaf
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Invalid column name 'RoleId'.
   at Microsoft.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__208_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.Tasks.Task.<>c.<.cctor>b__272_0(Object obj)
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location ---
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReaderAsync(RelationalCommandParameterObject parameterObject, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
ClientConnectionId:9b462139-d83d-4b07-9a9a-68950d1a8aaf
Error Number:207,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 16:30:59.875 +03:00 [INF] Executing BadRequestObjectResult, writing value of type 'System.String'.
2023-06-22 16:30:59.876 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 457.9443ms
2023-06-22 16:30:59.877 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:30:59.878 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 62 - 400 - text/plain;+charset=utf-8 466.8575ms
2023-06-22 16:32:41.789 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2023-06-22 16:32:41.847 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2023-06-22 16:32:41.850 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2023-06-22 16:32:41.851 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2023-06-22 16:32:41.866 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2023-06-22 16:32:41.883 +03:00 [INF] Applying migration '20230615095145_AddRoles'.
2023-06-22 16:32:41.980 +03:00 [INF] Executed DbCommand (15ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Users] ADD [RoleId] int NOT NULL DEFAULT 0;
2023-06-22 16:32:42.023 +03:00 [INF] Executed DbCommand (42ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Expenses]') AND [c].[name] = N'Amount');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [Expenses] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [Expenses] ALTER COLUMN [Amount] decimal(10,2) NOT NULL;
2023-06-22 16:32:42.029 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Roles] (
    [Id] int NOT NULL IDENTITY,
    [Name] int NOT NULL,
    CONSTRAINT [PK_Roles] PRIMARY KEY ([Id])
);
2023-06-22 16:32:42.046 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Roles]'))
    SET IDENTITY_INSERT [Roles] ON;
INSERT INTO [Roles] ([Id], [Name])
VALUES (1, 1),
(2, 2);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Roles]'))
    SET IDENTITY_INSERT [Roles] OFF;
2023-06-22 16:32:42.068 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Users_RoleId] ON [Users] ([RoleId]);
2023-06-22 16:32:42.090 +03:00 [ERR] Failed executing DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Users] ADD CONSTRAINT [FK_Users_Roles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [Roles] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:39.353 +03:00 [INF] Executed DbCommand (157ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
CREATE DATABASE [ExpenseMaster];
2023-06-22 16:34:39.441 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='60']
IF SERVERPROPERTY('EngineEdition') <> 5
BEGIN
    ALTER DATABASE [ExpenseMaster] SET READ_COMMITTED_SNAPSHOT ON;
END;
2023-06-22 16:34:39.459 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2023-06-22 16:34:39.558 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [__EFMigrationsHistory] (
    [MigrationId] nvarchar(150) NOT NULL,
    [ProductVersion] nvarchar(32) NOT NULL,
    CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY ([MigrationId])
);
2023-06-22 16:34:39.559 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2023-06-22 16:34:39.582 +03:00 [INF] Executed DbCommand (18ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2023-06-22 16:34:39.594 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2023-06-22 16:34:39.618 +03:00 [INF] Applying migration '20230607115256_CreateDatabase'.
2023-06-22 16:34:39.665 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Category] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Category] PRIMARY KEY ([Id])
);
2023-06-22 16:34:39.667 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Users] (
    [Id] int NOT NULL IDENTITY,
    [Name] nvarchar(max) NOT NULL,
    [PasswordHash] varbinary(max) NOT NULL,
    [PasswordSalt] varbinary(max) NOT NULL,
    [Email] nvarchar(max) NOT NULL,
    CONSTRAINT [PK_Users] PRIMARY KEY ([Id])
);
2023-06-22 16:34:39.670 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Budgets] (
    [Id] int NOT NULL IDENTITY,
    [Limit] decimal(18,2) NOT NULL,
    [WarningThreshold] decimal(18,2) NOT NULL,
    [UserId1] int NULL,
    [CategoryId1] int NULL,
    CONSTRAINT [PK_Budgets] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Budgets_Category_CategoryId1] FOREIGN KEY ([CategoryId1]) REFERENCES [Category] ([Id]),
    CONSTRAINT [FK_Budgets_Users_UserId1] FOREIGN KEY ([UserId1]) REFERENCES [Users] ([Id])
);
2023-06-22 16:34:39.673 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Expenses] (
    [Id] int NOT NULL IDENTITY,
    [CategoryId] int NOT NULL,
    [Amount] decimal(18,2) NOT NULL,
    [Date] datetime2 NOT NULL,
    [UserId] int NULL,
    CONSTRAINT [PK_Expenses] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Expenses_Category_CategoryId] FOREIGN KEY ([CategoryId]) REFERENCES [Category] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Expenses_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id])
);
2023-06-22 16:34:39.894 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [FinancialGoal] (
    [Id] int NOT NULL IDENTITY,
    [GoalName] nvarchar(max) NOT NULL,
    [TargetAmount] decimal(18,2) NOT NULL,
    [CurrentAmount] decimal(18,2) NOT NULL,
    [UserId] int NULL,
    CONSTRAINT [PK_FinancialGoal] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_FinancialGoal_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id])
);
2023-06-22 16:34:39.897 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Incomes] (
    [Id] int NOT NULL IDENTITY,
    [UserId] int NOT NULL,
    [CategoryId] int NOT NULL,
    [Amount] decimal(18,2) NOT NULL,
    [Date] datetime2 NOT NULL,
    CONSTRAINT [PK_Incomes] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_Incomes_Category_CategoryId] FOREIGN KEY ([CategoryId]) REFERENCES [Category] ([Id]) ON DELETE CASCADE,
    CONSTRAINT [FK_Incomes_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE
);
2023-06-22 16:34:39.899 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Budgets_CategoryId1] ON [Budgets] ([CategoryId1]);
2023-06-22 16:34:39.901 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Budgets_UserId1] ON [Budgets] ([UserId1]);
2023-06-22 16:34:39.902 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Expenses_CategoryId] ON [Expenses] ([CategoryId]);
2023-06-22 16:34:39.903 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Expenses_UserId] ON [Expenses] ([UserId]);
2023-06-22 16:34:39.906 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_FinancialGoal_UserId] ON [FinancialGoal] ([UserId]);
2023-06-22 16:34:41.320 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Incomes_CategoryId] ON [Incomes] ([CategoryId]);
2023-06-22 16:34:41.322 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Incomes_UserId] ON [Incomes] ([UserId]);
2023-06-22 16:34:41.332 +03:00 [INF] Executed DbCommand (10ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230607115256_CreateDatabase', N'7.0.5');
2023-06-22 16:34:41.341 +03:00 [INF] Applying migration '20230608090131_CleanCode'.
2023-06-22 16:34:41.386 +03:00 [INF] Executed DbCommand (8ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] DROP CONSTRAINT [FK_Budgets_Category_CategoryId1];
2023-06-22 16:34:41.389 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] DROP CONSTRAINT [FK_Budgets_Users_UserId1];
2023-06-22 16:34:41.391 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Expenses] DROP CONSTRAINT [FK_Expenses_Users_UserId];
2023-06-22 16:34:41.394 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [FinancialGoal] DROP CONSTRAINT [FK_FinancialGoal_Users_UserId];
2023-06-22 16:34:41.397 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX [IX_Budgets_CategoryId1] ON [Budgets];
2023-06-22 16:34:41.399 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX [IX_Budgets_UserId1] ON [Budgets];
2023-06-22 16:34:41.531 +03:00 [INF] Executed DbCommand (132ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Budgets]') AND [c].[name] = N'CategoryId1');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [Budgets] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [Budgets] DROP COLUMN [CategoryId1];
2023-06-22 16:34:42.337 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var1 sysname;
SELECT @var1 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Budgets]') AND [c].[name] = N'UserId1');
IF @var1 IS NOT NULL EXEC(N'ALTER TABLE [Budgets] DROP CONSTRAINT [' + @var1 + '];');
ALTER TABLE [Budgets] DROP COLUMN [UserId1];
2023-06-22 16:34:42.372 +03:00 [INF] Executed DbCommand (34ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX [IX_FinancialGoal_UserId] ON [FinancialGoal];
DECLARE @var2 sysname;
SELECT @var2 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[FinancialGoal]') AND [c].[name] = N'UserId');
IF @var2 IS NOT NULL EXEC(N'ALTER TABLE [FinancialGoal] DROP CONSTRAINT [' + @var2 + '];');
UPDATE [FinancialGoal] SET [UserId] = 0 WHERE [UserId] IS NULL;
ALTER TABLE [FinancialGoal] ALTER COLUMN [UserId] int NOT NULL;
ALTER TABLE [FinancialGoal] ADD DEFAULT 0 FOR [UserId];
CREATE INDEX [IX_FinancialGoal_UserId] ON [FinancialGoal] ([UserId]);
2023-06-22 16:34:42.413 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DROP INDEX [IX_Expenses_UserId] ON [Expenses];
DECLARE @var3 sysname;
SELECT @var3 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Expenses]') AND [c].[name] = N'UserId');
IF @var3 IS NOT NULL EXEC(N'ALTER TABLE [Expenses] DROP CONSTRAINT [' + @var3 + '];');
UPDATE [Expenses] SET [UserId] = 0 WHERE [UserId] IS NULL;
ALTER TABLE [Expenses] ALTER COLUMN [UserId] int NOT NULL;
ALTER TABLE [Expenses] ADD DEFAULT 0 FOR [UserId];
CREATE INDEX [IX_Expenses_UserId] ON [Expenses] ([UserId]);
2023-06-22 16:34:43.267 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] ADD [CategoryId] int NOT NULL DEFAULT 0;
2023-06-22 16:34:43.269 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] ADD [UserId] int NOT NULL DEFAULT 0;
2023-06-22 16:34:43.271 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Budgets_CategoryId] ON [Budgets] ([CategoryId]);
2023-06-22 16:34:43.272 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Budgets_UserId] ON [Budgets] ([UserId]);
2023-06-22 16:34:43.274 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] ADD CONSTRAINT [FK_Budgets_Category_CategoryId] FOREIGN KEY ([CategoryId]) REFERENCES [Category] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:43.276 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] ADD CONSTRAINT [FK_Budgets_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:43.278 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Expenses] ADD CONSTRAINT [FK_Expenses_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:43.279 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [FinancialGoal] ADD CONSTRAINT [FK_FinancialGoal_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:43.285 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230608090131_CleanCode', N'7.0.5');
2023-06-22 16:34:44.357 +03:00 [INF] Applying migration '20230608090526_RenameLogin'.
2023-06-22 16:34:44.659 +03:00 [INF] Executed DbCommand (295ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXEC sp_rename N'[Users].[Name]', N'Login', N'COLUMN';
2023-06-22 16:34:44.663 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230608090526_RenameLogin', N'7.0.5');
2023-06-22 16:34:44.663 +03:00 [INF] Applying migration '20230608103721_AddAnnotations'.
2023-06-22 16:34:44.702 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var4 sysname;
SELECT @var4 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Users]') AND [c].[name] = N'Login');
IF @var4 IS NOT NULL EXEC(N'ALTER TABLE [Users] DROP CONSTRAINT [' + @var4 + '];');
ALTER TABLE [Users] ALTER COLUMN [Login] nvarchar(20) NOT NULL;
2023-06-22 16:34:44.735 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var5 sysname;
SELECT @var5 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Users]') AND [c].[name] = N'Email');
IF @var5 IS NOT NULL EXEC(N'ALTER TABLE [Users] DROP CONSTRAINT [' + @var5 + '];');
ALTER TABLE [Users] ALTER COLUMN [Email] nvarchar(50) NOT NULL;
2023-06-22 16:34:44.766 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var6 sysname;
SELECT @var6 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Incomes]') AND [c].[name] = N'Amount');
IF @var6 IS NOT NULL EXEC(N'ALTER TABLE [Incomes] DROP CONSTRAINT [' + @var6 + '];');
ALTER TABLE [Incomes] ALTER COLUMN [Amount] decimal(10,2) NOT NULL;
2023-06-22 16:34:44.927 +03:00 [INF] Executed DbCommand (37ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var7 sysname;
SELECT @var7 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[FinancialGoal]') AND [c].[name] = N'TargetAmount');
IF @var7 IS NOT NULL EXEC(N'ALTER TABLE [FinancialGoal] DROP CONSTRAINT [' + @var7 + '];');
ALTER TABLE [FinancialGoal] ALTER COLUMN [TargetAmount] decimal(10,2) NOT NULL;
2023-06-22 16:34:44.961 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var8 sysname;
SELECT @var8 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[FinancialGoal]') AND [c].[name] = N'CurrentAmount');
IF @var8 IS NOT NULL EXEC(N'ALTER TABLE [FinancialGoal] DROP CONSTRAINT [' + @var8 + '];');
ALTER TABLE [FinancialGoal] ALTER COLUMN [CurrentAmount] decimal(10,2) NOT NULL;
2023-06-22 16:34:44.992 +03:00 [INF] Executed DbCommand (31ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var9 sysname;
SELECT @var9 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Expenses]') AND [c].[name] = N'Amount');
IF @var9 IS NOT NULL EXEC(N'ALTER TABLE [Expenses] DROP CONSTRAINT [' + @var9 + '];');
ALTER TABLE [Expenses] ALTER COLUMN [Amount] decimal(10,2) NOT NULL;
2023-06-22 16:34:46.116 +03:00 [INF] Executed DbCommand (29ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var10 sysname;
SELECT @var10 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Category]') AND [c].[name] = N'Name');
IF @var10 IS NOT NULL EXEC(N'ALTER TABLE [Category] DROP CONSTRAINT [' + @var10 + '];');
ALTER TABLE [Category] ALTER COLUMN [Name] nvarchar(50) NOT NULL;
2023-06-22 16:34:46.147 +03:00 [INF] Executed DbCommand (30ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var11 sysname;
SELECT @var11 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Budgets]') AND [c].[name] = N'WarningThreshold');
IF @var11 IS NOT NULL EXEC(N'ALTER TABLE [Budgets] DROP CONSTRAINT [' + @var11 + '];');
ALTER TABLE [Budgets] ALTER COLUMN [WarningThreshold] decimal(10,2) NOT NULL;
2023-06-22 16:34:46.171 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var12 sysname;
SELECT @var12 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Budgets]') AND [c].[name] = N'Limit');
IF @var12 IS NOT NULL EXEC(N'ALTER TABLE [Budgets] DROP CONSTRAINT [' + @var12 + '];');
ALTER TABLE [Budgets] ALTER COLUMN [Limit] decimal(10,2) NOT NULL;
2023-06-22 16:34:46.172 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230608103721_AddAnnotations', N'7.0.5');
2023-06-22 16:34:47.163 +03:00 [INF] Applying migration '20230608233034_FluentAPI'.
2023-06-22 16:34:47.177 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] DROP CONSTRAINT [FK_Budgets_Category_CategoryId];
2023-06-22 16:34:47.180 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Expenses] DROP CONSTRAINT [FK_Expenses_Category_CategoryId];
2023-06-22 16:34:47.182 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [FinancialGoal] DROP CONSTRAINT [FK_FinancialGoal_Users_UserId];
2023-06-22 16:34:47.184 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Incomes] DROP CONSTRAINT [FK_Incomes_Category_CategoryId];
2023-06-22 16:34:47.187 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [FinancialGoal] DROP CONSTRAINT [PK_FinancialGoal];
2023-06-22 16:34:47.189 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Category] DROP CONSTRAINT [PK_Category];
2023-06-22 16:34:47.502 +03:00 [INF] Executed DbCommand (313ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXEC sp_rename N'[FinancialGoal]', N'FinancialGoals';
2023-06-22 16:34:47.504 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXEC sp_rename N'[Category]', N'Categories';
2023-06-22 16:34:47.505 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
EXEC sp_rename N'[FinancialGoals].[IX_FinancialGoal_UserId]', N'IX_FinancialGoals_UserId', N'INDEX';
2023-06-22 16:34:47.526 +03:00 [INF] Executed DbCommand (21ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var13 sysname;
SELECT @var13 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Users]') AND [c].[name] = N'Email');
IF @var13 IS NOT NULL EXEC(N'ALTER TABLE [Users] DROP CONSTRAINT [' + @var13 + '];');
ALTER TABLE [Users] ALTER COLUMN [Email] nvarchar(30) NOT NULL;
2023-06-22 16:34:48.281 +03:00 [INF] Executed DbCommand (24ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var14 sysname;
SELECT @var14 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Incomes]') AND [c].[name] = N'Date');
IF @var14 IS NOT NULL EXEC(N'ALTER TABLE [Incomes] DROP CONSTRAINT [' + @var14 + '];');
ALTER TABLE [Incomes] ALTER COLUMN [Date] date NOT NULL;
2023-06-22 16:34:48.305 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var15 sysname;
SELECT @var15 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Expenses]') AND [c].[name] = N'Date');
IF @var15 IS NOT NULL EXEC(N'ALTER TABLE [Expenses] DROP CONSTRAINT [' + @var15 + '];');
ALTER TABLE [Expenses] ALTER COLUMN [Date] date NOT NULL;
2023-06-22 16:34:48.318 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var16 sysname;
SELECT @var16 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Categories]') AND [c].[name] = N'Name');
IF @var16 IS NOT NULL EXEC(N'ALTER TABLE [Categories] DROP CONSTRAINT [' + @var16 + '];');
ALTER TABLE [Categories] ALTER COLUMN [Name] nvarchar(30) NOT NULL;
2023-06-22 16:34:48.320 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [FinancialGoals] ADD CONSTRAINT [PK_FinancialGoals] PRIMARY KEY ([Id]);
2023-06-22 16:34:49.209 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Categories] ADD CONSTRAINT [PK_Categories] PRIMARY KEY ([Id]);
2023-06-22 16:34:49.211 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Budgets] ADD CONSTRAINT [FK_Budgets_Categories_CategoryId] FOREIGN KEY ([CategoryId]) REFERENCES [Categories] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:49.212 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Expenses] ADD CONSTRAINT [FK_Expenses_Categories_CategoryId] FOREIGN KEY ([CategoryId]) REFERENCES [Categories] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:49.212 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [FinancialGoals] ADD CONSTRAINT [FK_FinancialGoals_Users_UserId] FOREIGN KEY ([UserId]) REFERENCES [Users] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:49.213 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Incomes] ADD CONSTRAINT [FK_Incomes_Categories_CategoryId] FOREIGN KEY ([CategoryId]) REFERENCES [Categories] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:49.217 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230608233034_FluentAPI', N'7.0.5');
2023-06-22 16:34:49.219 +03:00 [INF] Applying migration '20230615095145_AddRoles'.
2023-06-22 16:34:49.252 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Users] ADD [RoleId] int NOT NULL DEFAULT 0;
2023-06-22 16:34:49.278 +03:00 [INF] Executed DbCommand (26ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var17 sysname;
SELECT @var17 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Expenses]') AND [c].[name] = N'Amount');
IF @var17 IS NOT NULL EXEC(N'ALTER TABLE [Expenses] DROP CONSTRAINT [' + @var17 + '];');
ALTER TABLE [Expenses] ALTER COLUMN [Amount] decimal(10,2) NOT NULL;
2023-06-22 16:34:50.019 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [Roles] (
    [Id] int NOT NULL IDENTITY,
    [Name] int NOT NULL,
    CONSTRAINT [PK_Roles] PRIMARY KEY ([Id])
);
2023-06-22 16:34:50.039 +03:00 [INF] Executed DbCommand (20ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Roles]'))
    SET IDENTITY_INSERT [Roles] ON;
INSERT INTO [Roles] ([Id], [Name])
VALUES (1, 1),
(2, 2);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Roles]'))
    SET IDENTITY_INSERT [Roles] OFF;
2023-06-22 16:34:50.040 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_Users_RoleId] ON [Users] ([RoleId]);
2023-06-22 16:34:50.041 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE [Users] ADD CONSTRAINT [FK_Users_Roles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [Roles] ([Id]) ON DELETE CASCADE;
2023-06-22 16:34:50.042 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20230615095145_AddRoles', N'7.0.5');
2023-06-22 16:34:50.044 +03:00 [INF] Applying migration '20230615125220_addModel'.
2023-06-22 16:34:50.140 +03:00 [INF] Executed DbCommand (86ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var18 sysname;
SELECT @var18 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Expenses]') AND [c].[name] = N'Amount');
IF @var18 IS NOT NULL EXEC(N'ALTER TABLE [Expenses] DROP CONSTRAINT [' + @var18 + '];');
ALTER TABLE [Expenses] ALTER COLUMN [Amount] decimal(10,2) NOT NULL;
2023-06-22 16:34:50.809 +03:00 [INF] Executed DbCommand (13ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Categories]'))
    SET IDENTITY_INSERT [Categories] ON;
INSERT INTO [Categories] ([Id], [Name])
VALUES (1, N'Category 1'),
(2, N'Category 2'),
(3, N'Category 3'),
(4, N'Category 4'),
(5, N'Category 5');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Categories]'))
    SET IDENTITY_INSERT [Categories] OFF;
2023-06-22 16:34:50.833 +03:00 [ERR] Failed executing DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Amount', N'CategoryId', N'Date', N'UserId') AND [object_id] = OBJECT_ID(N'[Expenses]'))
    SET IDENTITY_INSERT [Expenses] ON;
INSERT INTO [Expenses] ([Id], [Amount], [CategoryId], [Date], [UserId])
VALUES (1, 100.0, 1, '2023-06-15', 1),
(2, 50.0, 2, '2023-06-15', 1),
(3, 75.0, 1, '2023-06-15', 2),
(4, 120.0, 3, '2023-06-15', 2),
(5, 200.0, 2, '2023-06-15', 3);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Amount', N'CategoryId', N'Date', N'UserId') AND [object_id] = OBJECT_ID(N'[Expenses]'))
    SET IDENTITY_INSERT [Expenses] OFF;
2023-06-22 16:36:42.198 +03:00 [INF] Executed DbCommand (38ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:36:42.407 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:36:42.431 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:36:42.652 +03:00 [INF] Executed DbCommand (80ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 30), @p2='?' (Size = 30), @p3='?' (Size = 30), @p4='?' (Size = 30), @p5='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p6='?' (DbType = Int32), @p7='?' (DbType = Date), @p8='?' (DbType = Int32), @p9='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p10='?' (DbType = Int32), @p11='?' (DbType = Date), @p12='?' (DbType = Int32), @p13='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p14='?' (DbType = Int32), @p15='?' (DbType = Date), @p16='?' (DbType = Int32), @p17='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p18='?' (DbType = Int32), @p19='?' (DbType = Date), @p20='?' (DbType = Int32), @p21='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p22='?' (DbType = Int32), @p23='?' (DbType = Date), @p24='?' (DbType = Int32), @p25='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p26='?' (DbType = Int32), @p27='?' (DbType = Date), @p28='?' (DbType = Int32), @p29='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p30='?' (DbType = Int32), @p31='?' (DbType = Date), @p32='?' (DbType = Int32), @p33='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p34='?' (DbType = Int32), @p35='?' (DbType = Date), @p36='?' (DbType = Int32), @p37='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p38='?' (DbType = Int32), @p39='?' (DbType = Date), @p40='?' (DbType = Int32), @p41='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p42='?' (DbType = Int32), @p43='?' (DbType = Date), @p44='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [Categories] USING (
VALUES (@p0, 0),
(@p1, 1),
(@p2, 2),
(@p3, 3),
(@p4, 4)) AS i ([Name], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Name])
VALUES (i.[Name])
OUTPUT INSERTED.[Id], i._Position;
MERGE [Expenses] USING (
VALUES (@p5, @p6, @p7, @p8, 0),
(@p9, @p10, @p11, @p12, 1),
(@p13, @p14, @p15, @p16, 2),
(@p17, @p18, @p19, @p20, 3),
(@p21, @p22, @p23, @p24, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
MERGE [Incomes] USING (
VALUES (@p25, @p26, @p27, @p28, 0),
(@p29, @p30, @p31, @p32, 1),
(@p33, @p34, @p35, @p36, 2),
(@p37, @p38, @p39, @p40, 3),
(@p41, @p42, @p43, @p44, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
2023-06-22 16:36:42.738 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Users_UserId". The conflict occurred in database "ExpenseMaster", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.Read()
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
ClientConnectionId:0436d6e2-8e92-4e32-96a2-3c2523f14235
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Users_UserId". The conflict occurred in database "ExpenseMaster", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.Read()
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
ClientConnectionId:0436d6e2-8e92-4e32-96a2-3c2523f14235
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
2023-06-22 16:37:01.029 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:01.235 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:01.274 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:01.330 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 16:37:01.566 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 16:37:01.567 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 16:37:01.572 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 16:37:01.573 +03:00 [INF] Hosting environment: Development
2023-06-22 16:37:01.574 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 16:37:02.639 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 16:37:03.204 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 569.7905ms
2023-06-22 16:37:03.661 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 16:37:03.661 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 16:37:03.682 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 20.2265ms
2023-06-22 16:37:03.780 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 118.8539ms
2023-06-22 16:37:04.343 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 16:37:04.797 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 454.5456ms
2023-06-22 16:37:17.972 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 58
2023-06-22 16:37:18.085 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:18.120 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:37:18.461 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:18.655 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 20), @p2='?' (Size = 8000) (DbType = Binary), @p3='?' (Size = 8000) (DbType = Binary), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [PasswordSalt], [RoleId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-22 16:37:18.748 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto'.
2023-06-22 16:37:18.770 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 637.8862ms
2023-06-22 16:37:18.774 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:18.791 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 58 - 200 - application/json;+charset=utf-8 818.5477ms
2023-06-22 16:37:28.856 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 59
2023-06-22 16:37:28.859 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:28.860 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:37:28.931 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:28.937 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 20), @p2='?' (Size = 8000) (DbType = Binary), @p3='?' (Size = 8000) (DbType = Binary), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [PasswordSalt], [RoleId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-22 16:37:28.939 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto'.
2023-06-22 16:37:28.940 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 78.9199ms
2023-06-22 16:37:28.941 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:28.943 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 59 - 200 - application/json;+charset=utf-8 86.9688ms
2023-06-22 16:37:35.069 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 60
2023-06-22 16:37:35.073 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:35.074 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:37:35.085 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:35.091 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 20), @p2='?' (Size = 8000) (DbType = Binary), @p3='?' (Size = 8000) (DbType = Binary), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [PasswordSalt], [RoleId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-22 16:37:35.093 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto'.
2023-06-22 16:37:35.095 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 17.2517ms
2023-06-22 16:37:35.098 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:35.100 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 60 - 200 - application/json;+charset=utf-8 30.7694ms
2023-06-22 16:37:41.630 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 61
2023-06-22 16:37:41.632 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:41.634 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:37:41.640 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:41.651 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 20), @p2='?' (Size = 8000) (DbType = Binary), @p3='?' (Size = 8000) (DbType = Binary), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [PasswordSalt], [RoleId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-22 16:37:41.653 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto'.
2023-06-22 16:37:41.654 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 17.7788ms
2023-06-22 16:37:41.656 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:41.657 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 61 - 200 - application/json;+charset=utf-8 26.6039ms
2023-06-22 16:37:45.754 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 62
2023-06-22 16:37:45.756 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:45.758 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:37:45.766 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:37:45.772 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 20), @p2='?' (Size = 8000) (DbType = Binary), @p3='?' (Size = 8000) (DbType = Binary), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [PasswordSalt], [RoleId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-22 16:37:45.774 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto'.
2023-06-22 16:37:45.776 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 13.9867ms
2023-06-22 16:37:45.777 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 16:37:45.779 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 62 - 200 - application/json;+charset=utf-8 37.6498ms
2023-06-22 16:38:02.184 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:38:02.387 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:38:02.410 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:38:02.641 +03:00 [INF] Executed DbCommand (70ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 30), @p2='?' (Size = 30), @p3='?' (Size = 30), @p4='?' (Size = 30), @p5='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p6='?' (DbType = Int32), @p7='?' (DbType = Date), @p8='?' (DbType = Int32), @p9='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p10='?' (DbType = Int32), @p11='?' (DbType = Date), @p12='?' (DbType = Int32), @p13='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p14='?' (DbType = Int32), @p15='?' (DbType = Date), @p16='?' (DbType = Int32), @p17='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p18='?' (DbType = Int32), @p19='?' (DbType = Date), @p20='?' (DbType = Int32), @p21='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p22='?' (DbType = Int32), @p23='?' (DbType = Date), @p24='?' (DbType = Int32), @p25='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p26='?' (DbType = Int32), @p27='?' (DbType = Date), @p28='?' (DbType = Int32), @p29='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p30='?' (DbType = Int32), @p31='?' (DbType = Date), @p32='?' (DbType = Int32), @p33='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p34='?' (DbType = Int32), @p35='?' (DbType = Date), @p36='?' (DbType = Int32), @p37='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p38='?' (DbType = Int32), @p39='?' (DbType = Date), @p40='?' (DbType = Int32), @p41='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p42='?' (DbType = Int32), @p43='?' (DbType = Date), @p44='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [Categories] USING (
VALUES (@p0, 0),
(@p1, 1),
(@p2, 2),
(@p3, 3),
(@p4, 4)) AS i ([Name], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Name])
VALUES (i.[Name])
OUTPUT INSERTED.[Id], i._Position;
MERGE [Expenses] USING (
VALUES (@p5, @p6, @p7, @p8, 0),
(@p9, @p10, @p11, @p12, 1),
(@p13, @p14, @p15, @p16, 2),
(@p17, @p18, @p19, @p20, 3),
(@p21, @p22, @p23, @p24, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
MERGE [Incomes] USING (
VALUES (@p25, @p26, @p27, @p28, 0),
(@p29, @p30, @p31, @p32, 1),
(@p33, @p34, @p35, @p36, 2),
(@p37, @p38, @p39, @p40, 3),
(@p41, @p42, @p43, @p44, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
2023-06-22 16:38:02.721 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.Read()
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
ClientConnectionId:5fc5a98f-9fa5-4090-a178-ccc5660e397d
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.Read()
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSet(Int32 startCommandIndex, RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
ClientConnectionId:5fc5a98f-9fa5-4090-a178-ccc5660e397d
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.Consume(RelationalDataReader reader)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
2023-06-22 16:39:18.466 +03:00 [INF] Executed DbCommand (39ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:39:18.671 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:39:18.724 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:39:18.986 +03:00 [ERR] Failed executing DbCommand (68ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (Size = 30), @p2='?' (DbType = Int32), @p3='?' (Size = 30), @p4='?' (DbType = Int32), @p5='?' (Size = 30), @p6='?' (DbType = Int32), @p7='?' (Size = 30), @p8='?' (DbType = Int32), @p9='?' (Size = 30), @p10='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p11='?' (DbType = Int32), @p12='?' (DbType = Date), @p13='?' (DbType = Int32), @p14='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p15='?' (DbType = Int32), @p16='?' (DbType = Date), @p17='?' (DbType = Int32), @p18='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p19='?' (DbType = Int32), @p20='?' (DbType = Date), @p21='?' (DbType = Int32), @p22='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p23='?' (DbType = Int32), @p24='?' (DbType = Date), @p25='?' (DbType = Int32), @p26='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p27='?' (DbType = Int32), @p28='?' (DbType = Date), @p29='?' (DbType = Int32), @p30='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p31='?' (DbType = Int32), @p32='?' (DbType = Date), @p33='?' (DbType = Int32), @p34='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p35='?' (DbType = Int32), @p36='?' (DbType = Date), @p37='?' (DbType = Int32), @p38='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p39='?' (DbType = Int32), @p40='?' (DbType = Date), @p41='?' (DbType = Int32), @p42='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p43='?' (DbType = Int32), @p44='?' (DbType = Date), @p45='?' (DbType = Int32), @p46='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p47='?' (DbType = Int32), @p48='?' (DbType = Date), @p49='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [Categories] ([Id], [Name])
VALUES (@p0, @p1),
(@p2, @p3),
(@p4, @p5),
(@p6, @p7),
(@p8, @p9);
MERGE [Expenses] USING (
VALUES (@p10, @p11, @p12, @p13, 0),
(@p14, @p15, @p16, @p17, 1),
(@p18, @p19, @p20, @p21, 2),
(@p22, @p23, @p24, @p25, 3),
(@p26, @p27, @p28, @p29, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
MERGE [Incomes] USING (
VALUES (@p30, @p31, @p32, @p33, 0),
(@p34, @p35, @p36, @p37, 1),
(@p38, @p39, @p40, @p41, 2),
(@p42, @p43, @p44, @p45, 3),
(@p46, @p47, @p48, @p49, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
2023-06-22 16:39:19.032 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert explicit value for identity column in table 'Categories' when IDENTITY_INSERT is set to OFF.
The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
The statement has been terminated.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
ClientConnectionId:a9d09ae7-dc32-4490-8dcc-f0e6ae022d01
Error Number:544,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): Cannot insert explicit value for identity column in table 'Categories' when IDENTITY_INSERT is set to OFF.
The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
The MERGE statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
The statement has been terminated.
The statement has been terminated.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryConsumeMetaData()
   at Microsoft.Data.SqlClient.SqlDataReader.get_MetaData()
   at Microsoft.Data.SqlClient.SqlCommand.FinishExecuteReader(SqlDataReader ds, RunBehavior runBehavior, String resetOptionsString, Boolean isInternal, Boolean forDescribeParameterEncryption, Boolean shouldCacheForAlwaysEncrypted)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReaderTds(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, Boolean isAsync, Int32 timeout, Task& task, Boolean asyncWrite, Boolean inRetry, SqlDataReader ds, Boolean describeParameterEncryptionRequest)
   at Microsoft.Data.SqlClient.SqlCommand.RunExecuteReader(CommandBehavior cmdBehavior, RunBehavior runBehavior, Boolean returnStream, TaskCompletionSource`1 completion, Int32 timeout, Task& task, Boolean& usedCache, Boolean asyncWrite, Boolean inRetry, String method)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteReader(CommandBehavior behavior)
   at Microsoft.Data.SqlClient.SqlCommand.ExecuteDbDataReader(CommandBehavior behavior)
   at Microsoft.EntityFrameworkCore.Storage.RelationalCommand.ExecuteReader(RelationalCommandParameterObject parameterObject)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
ClientConnectionId:a9d09ae7-dc32-4490-8dcc-f0e6ae022d01
Error Number:544,State:1,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.Execute(IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.Execute(IEnumerable`1 commandBatches, IRelationalConnection connection)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(IList`1 entriesToSave)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(StateManager stateManager, Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.Execute[TState,TResult](TState state, Func`3 operation, Func`3 verifySucceeded)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChanges(Boolean acceptAllChangesOnSuccess)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChanges(Boolean acceptAllChangesOnSuccess)
2023-06-22 16:40:13.971 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:40:14.348 +03:00 [INF] Executed DbCommand (41ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 30), @p2='?' (Size = 30), @p3='?' (Size = 30), @p4='?' (Size = 30)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
MERGE [Categories] USING (
VALUES (@p0, 0),
(@p1, 1),
(@p2, 2),
(@p3, 3),
(@p4, 4)) AS i ([Name], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Name])
VALUES (i.[Name])
OUTPUT INSERTED.[Id], i._Position;
2023-06-22 16:40:14.421 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 16:40:14.605 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 16:40:14.612 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 16:40:14.618 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 16:40:14.620 +03:00 [INF] Hosting environment: Development
2023-06-22 16:40:14.621 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 16:40:15.596 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 16:40:16.106 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 515.8230ms
2023-06-22 16:40:16.781 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 16:40:16.782 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 16:40:16.854 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 72.3987ms
2023-06-22 16:40:16.886 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 105.0705ms
2023-06-22 16:40:17.860 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 16:40:18.315 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 454.7645ms
2023-06-22 16:41:24.253 +03:00 [INF] Executed DbCommand (52ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:41:24.383 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:41:24.501 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:41:24.785 +03:00 [INF] Executed DbCommand (67ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32), @p4='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p5='?' (DbType = Int32), @p6='?' (DbType = Date), @p7='?' (DbType = Int32), @p8='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p9='?' (DbType = Int32), @p10='?' (DbType = Date), @p11='?' (DbType = Int32), @p12='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p13='?' (DbType = Int32), @p14='?' (DbType = Date), @p15='?' (DbType = Int32), @p16='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p17='?' (DbType = Int32), @p18='?' (DbType = Date), @p19='?' (DbType = Int32), @p20='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p21='?' (DbType = Int32), @p22='?' (DbType = Date), @p23='?' (DbType = Int32), @p24='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p25='?' (DbType = Int32), @p26='?' (DbType = Date), @p27='?' (DbType = Int32), @p28='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p29='?' (DbType = Int32), @p30='?' (DbType = Date), @p31='?' (DbType = Int32), @p32='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p33='?' (DbType = Int32), @p34='?' (DbType = Date), @p35='?' (DbType = Int32), @p36='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p37='?' (DbType = Int32), @p38='?' (DbType = Date), @p39='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
MERGE [Expenses] USING (
VALUES (@p0, @p1, @p2, @p3, 0),
(@p4, @p5, @p6, @p7, 1),
(@p8, @p9, @p10, @p11, 2),
(@p12, @p13, @p14, @p15, 3),
(@p16, @p17, @p18, @p19, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
MERGE [Incomes] USING (
VALUES (@p20, @p21, @p22, @p23, 0),
(@p24, @p25, @p26, @p27, 1),
(@p28, @p29, @p30, @p31, 2),
(@p32, @p33, @p34, @p35, 3),
(@p36, @p37, @p38, @p39, 4)) AS i ([Amount], [CategoryId], [Date], [UserId], _Position) ON 1=0
WHEN NOT MATCHED THEN
INSERT ([Amount], [CategoryId], [Date], [UserId])
VALUES (i.[Amount], i.[CategoryId], i.[Date], i.[UserId])
OUTPUT INSERTED.[Id], i._Position;
2023-06-22 16:41:24.899 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 16:41:25.239 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 16:41:25.240 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 16:41:25.249 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 16:41:25.251 +03:00 [INF] Hosting environment: Development
2023-06-22 16:41:25.252 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 16:41:26.464 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 16:41:27.204 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 748.6243ms
2023-06-22 16:41:27.824 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 16:41:27.824 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 16:41:27.840 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 16.0715ms
2023-06-22 16:41:27.973 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 148.0753ms
2023-06-22 16:41:28.619 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 16:41:28.992 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 372.6444ms
2023-06-22 16:43:38.275 +03:00 [INF] Executed DbCommand (16ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2023-06-22 16:43:38.333 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2023-06-22 16:43:38.336 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT 1
2023-06-22 16:43:38.337 +03:00 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2023-06-22 16:43:38.351 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2023-06-22 16:43:38.367 +03:00 [INF] Applying migration '20230615125220_addModel'.
2023-06-22 16:43:38.462 +03:00 [INF] Executed DbCommand (23ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
DECLARE @var0 sysname;
SELECT @var0 = [d].[name]
FROM [sys].[default_constraints] [d]
INNER JOIN [sys].[columns] [c] ON [d].[parent_column_id] = [c].[column_id] AND [d].[parent_object_id] = [c].[object_id]
WHERE ([d].[parent_object_id] = OBJECT_ID(N'[Expenses]') AND [c].[name] = N'Amount');
IF @var0 IS NOT NULL EXEC(N'ALTER TABLE [Expenses] DROP CONSTRAINT [' + @var0 + '];');
ALTER TABLE [Expenses] ALTER COLUMN [Amount] decimal(10,2) NOT NULL;
2023-06-22 16:43:38.473 +03:00 [INF] Executed DbCommand (11ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Categories]'))
    SET IDENTITY_INSERT [Categories] ON;
INSERT INTO [Categories] ([Id], [Name])
VALUES (1, N'Category 1'),
(2, N'Category 2'),
(3, N'Category 3'),
(4, N'Category 4'),
(5, N'Category 5');
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Name') AND [object_id] = OBJECT_ID(N'[Categories]'))
    SET IDENTITY_INSERT [Categories] OFF;
2023-06-22 16:43:38.487 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Amount', N'CategoryId', N'Date', N'UserId') AND [object_id] = OBJECT_ID(N'[Expenses]'))
    SET IDENTITY_INSERT [Expenses] ON;
INSERT INTO [Expenses] ([Id], [Amount], [CategoryId], [Date], [UserId])
VALUES (1, 100.0, 1, '2023-06-15', 1),
(2, 50.0, 2, '2023-06-15', 1),
(3, 75.0, 1, '2023-06-15', 2),
(4, 120.0, 3, '2023-06-15', 2),
(5, 200.0, 2, '2023-06-15', 3);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Amount', N'CategoryId', N'Date', N'UserId') AND [object_id] = OBJECT_ID(N'[Expenses]'))
    SET IDENTITY_INSERT [Expenses] OFF;
2023-06-22 16:43:38.506 +03:00 [ERR] Failed executing DbCommand (19ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Amount', N'CategoryId', N'Date', N'UserId') AND [object_id] = OBJECT_ID(N'[Incomes]'))
    SET IDENTITY_INSERT [Incomes] ON;
INSERT INTO [Incomes] ([Id], [Amount], [CategoryId], [Date], [UserId])
VALUES (1, 1000.0, 1, '2023-06-15', 1),
(2, 750.0, 2, '2023-06-15', 1),
(3, 500.0, 1, '2023-06-15', 2),
(4, 1200.0, 3, '2023-06-15', 2),
(5, 800.0, 2, '2023-06-15', 3);
IF EXISTS (SELECT * FROM [sys].[identity_columns] WHERE [name] IN (N'Id', N'Amount', N'CategoryId', N'Date', N'UserId') AND [object_id] = OBJECT_ID(N'[Incomes]'))
    SET IDENTITY_INSERT [Incomes] OFF;
2023-06-22 16:44:13.375 +03:00 [INF] Executed DbCommand (66ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:44:13.536 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:44:13.541 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 16:44:13.601 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 16:44:13.795 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 16:44:13.796 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 16:44:13.801 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 16:44:13.803 +03:00 [INF] Hosting environment: Development
2023-06-22 16:44:13.804 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 16:44:14.786 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 16:44:15.288 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 509.9327ms
2023-06-22 16:44:15.701 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 16:44:15.702 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 16:44:15.714 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 12.5842ms
2023-06-22 16:44:15.794 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 92.8631ms
2023-06-22 16:44:16.201 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 16:44:16.423 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 221.7318ms
2023-06-22 16:44:26.431 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Login application/json 37
2023-06-22 16:44:26.530 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Get (ExpenseMaster)'
2023-06-22 16:44:26.562 +03:00 [INF] Route matched with {action = "Get", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Get(ExpenseMaster.BusinessLogic.Dto.UserLoginDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 16:44:27.118 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[@__login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[PasswordSalt], [u].[RoleId], [r].[Id], [r].[Name]
FROM [Users] AS [u]
INNER JOIN [Roles] AS [r] ON [u].[RoleId] = [r].[Id]
WHERE [u].[Login] = @__login_0
2023-06-22 16:44:27.497 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.SuccesLoginDto'.
2023-06-22 16:44:27.516 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Get (ExpenseMaster) in 946.0041ms
2023-06-22 16:44:27.519 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Get (ExpenseMaster)'
2023-06-22 16:44:27.536 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Login application/json 37 - 200 - application/json;+charset=utf-8 1104.6734ms
2023-06-22 16:45:05.067 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Profile - -
2023-06-22 16:45:05.161 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ProfileController.GetProfileAsync (ExpenseMaster)'
2023-06-22 16:45:05.165 +03:00 [INF] Route matched with {action = "GetProfile", controller = "Profile"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto]] GetProfileAsync() on controller ExpenseMaster.Controllers.ProfileController (ExpenseMaster).
2023-06-22 16:45:05.248 +03:00 [INF] Executed action ExpenseMaster.Controllers.ProfileController.GetProfileAsync (ExpenseMaster) in 81.5608ms
2023-06-22 16:45:05.250 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ProfileController.GetProfileAsync (ExpenseMaster)'
2023-06-22 16:45:05.281 +03:00 [ERR] There was an error.
System.FormatException: Input string was not in a correct format.
   at System.Number.ThrowOverflowOrFormatException(ParsingStatus status, TypeCode type)
   at System.Int32.Parse(String s)
   at ExpenseMaster.BusinessLogic.Implementations.TokenService.GetUserIdFromClaims(ClaimsPrincipal claimsPrincipal) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\TokenService.cs:line 52
   at ExpenseMaster.Controllers.ProfileController.GetProfileAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\ProfileController.cs:line 25
   at lambda_method45(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.InvokeInnerFilterAsync()
--- End of stack trace from previous location ---
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 16:45:05.346 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Profile - - - 500 - - 280.0433ms
2023-06-22 17:13:48.001 +03:00 [INF] Executed DbCommand (47ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:13:48.129 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:13:48.135 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:13:48.198 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:13:48.457 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:13:48.458 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:13:48.464 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:13:48.465 +03:00 [INF] Hosting environment: Development
2023-06-22 17:13:48.466 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:13:49.356 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:13:49.901 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 548.9602ms
2023-06-22 17:13:50.395 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:13:50.395 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:13:50.426 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 31.2277ms
2023-06-22 17:13:50.597 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 202.0743ms
2023-06-22 17:13:51.288 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:13:51.648 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 359.5303ms
2023-06-22 17:14:00.039 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/1/total - -
2023-06-22 17:14:00.171 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:00.209 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:14:00.594 +03:00 [INF] Executed DbCommand (45ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:14:00.611 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:14:00.632 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 414.2139ms
2023-06-22 17:14:00.637 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:00.653 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/1/total - - - 200 - application/json;+charset=utf-8 614.0102ms
2023-06-22 17:14:03.782 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/2/total - -
2023-06-22 17:14:03.785 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:03.787 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:14:03.843 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:14:03.845 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:14:03.847 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 57.7565ms
2023-06-22 17:14:03.849 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:03.850 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/2/total - - - 200 - application/json;+charset=utf-8 68.3139ms
2023-06-22 17:14:08.828 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - -
2023-06-22 17:14:08.850 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:08.852 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:14:08.869 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:14:08.872 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:14:08.874 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 15.6118ms
2023-06-22 17:14:08.875 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:08.876 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - - - 200 - application/json;+charset=utf-8 48.5600ms
2023-06-22 17:14:11.233 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/4/total - -
2023-06-22 17:14:11.235 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:11.236 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:14:11.241 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:14:11.247 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:14:11.250 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 12.3574ms
2023-06-22 17:14:11.251 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:11.252 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/4/total - - - 200 - application/json;+charset=utf-8 19.2487ms
2023-06-22 17:14:13.572 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/5/total - -
2023-06-22 17:14:13.573 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:13.575 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:14:13.586 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:14:13.590 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:14:13.592 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 15.138ms
2023-06-22 17:14:13.593 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:13.594 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/5/total - - - 200 - application/json;+charset=utf-8 22.5661ms
2023-06-22 17:14:15.829 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - -
2023-06-22 17:14:15.830 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:15.832 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:14:15.839 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:14:15.843 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:14:15.844 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 10.3827ms
2023-06-22 17:14:15.846 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:14:15.849 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - - - 200 - application/json;+charset=utf-8 19.9213ms
2023-06-22 17:14:32.385 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Income/user/3/total - -
2023-06-22 17:14:32.387 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster)'
2023-06-22 17:14:32.391 +03:00 [INF] Route matched with {action = "CalculateTotalIncomeByUserId", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalIncomeByUserId(Int32) on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:14:32.405 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:14:32.408 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:14:32.411 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster) in 17.8427ms
2023-06-22 17:14:32.413 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster)'
2023-06-22 17:14:32.415 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Income/user/3/total - - - 200 - application/json;+charset=utf-8 30.5012ms
2023-06-22 17:14:53.974 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 91
2023-06-22 17:14:53.979 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:14:53.984 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:14:54.326 +03:00 [INF] Executed DbCommand (36ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:14:54.428 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f39e05ff-a112-4c9e-9b38-92a0e504fe76
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f39e05ff-a112-4c9e-9b38-92a0e504fe76
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 17:14:54.615 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 629.336ms
2023-06-22 17:14:54.619 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:14:54.710 +03:00 [ERR] Error when accessing the database.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f39e05ff-a112-4c9e-9b38-92a0e504fe76
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ExpenseMaster.DAL.Repository.RepositoryWrapper.SaveAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.DAL\Repository\RepositoryWrapper.cs:line 88
   at ExpenseMaster.BusinessLogic.Implementations.ExpenseService.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\ExpenseService.cs:line 53
   at ExpenseMaster.Controllers.ExpenseController.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\ExpenseController.cs:line 39
   at lambda_method50(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:14:54.775 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 91 - 400 - - 836.4590ms
2023-06-22 17:15:04.140 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - -
2023-06-22 17:15:04.143 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:04.147 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:15:04.154 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:15:04.157 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:15:04.160 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 9.1802ms
2023-06-22 17:15:04.162 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:04.162 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - - - 200 - application/json;+charset=utf-8 22.9032ms
2023-06-22 17:15:06.208 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - -
2023-06-22 17:15:06.209 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:06.210 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:15:06.215 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:15:06.218 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:15:06.220 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 8.7687ms
2023-06-22 17:15:06.223 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:06.225 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - - - 200 - application/json;+charset=utf-8 17.5989ms
2023-06-22 17:15:07.362 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - -
2023-06-22 17:15:07.363 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:07.365 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:15:07.373 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:15:07.376 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:15:07.377 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 10.9405ms
2023-06-22 17:15:07.379 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:07.379 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - - - 200 - application/json;+charset=utf-8 17.1564ms
2023-06-22 17:15:12.530 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/2/total - -
2023-06-22 17:15:12.531 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:12.533 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:15:12.539 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:15:12.541 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:15:12.542 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 6.5824ms
2023-06-22 17:15:12.544 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:12.545 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/2/total - - - 200 - application/json;+charset=utf-8 15.2837ms
2023-06-22 17:15:15.132 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/4/total - -
2023-06-22 17:15:15.134 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:15.135 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:15:15.146 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:15:15.149 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:15:15.150 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 12.2359ms
2023-06-22 17:15:15.151 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:15.152 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/4/total - - - 200 - application/json;+charset=utf-8 20.4081ms
2023-06-22 17:15:17.225 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - -
2023-06-22 17:15:17.226 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:17.228 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:15:17.248 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:15:17.252 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:15:17.253 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 11.9425ms
2023-06-22 17:15:17.258 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:15:17.259 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/3/total - - - 200 - application/json;+charset=utf-8 34.4393ms
2023-06-22 17:15:50.169 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 91
2023-06-22 17:15:50.171 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:15:50.173 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:15:50.194 +03:00 [INF] Executed DbCommand (17ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:15:50.201 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f39e05ff-a112-4c9e-9b38-92a0e504fe76
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f39e05ff-a112-4c9e-9b38-92a0e504fe76
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 17:15:50.381 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 206.6354ms
2023-06-22 17:15:50.384 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:15:50.472 +03:00 [ERR] Error when accessing the database.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:f39e05ff-a112-4c9e-9b38-92a0e504fe76
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ExpenseMaster.DAL.Repository.RepositoryWrapper.SaveAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.DAL\Repository\RepositoryWrapper.cs:line 88
   at ExpenseMaster.BusinessLogic.Implementations.ExpenseService.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\ExpenseService.cs:line 53
   at ExpenseMaster.Controllers.ExpenseController.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\ExpenseController.cs:line 39
   at lambda_method50(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:15:50.482 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 91 - 400 - - 313.7103ms
2023-06-22 17:16:06.443 +03:00 [INF] Executed DbCommand (60ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:16:06.620 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:16:06.627 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:16:06.697 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:16:07.300 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:16:07.301 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:16:07.307 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:16:07.309 +03:00 [INF] Hosting environment: Development
2023-06-22 17:16:07.310 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:16:08.095 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:16:09.167 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 1082.5964ms
2023-06-22 17:16:10.030 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:16:10.031 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:16:10.054 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 24.3004ms
2023-06-22 17:16:10.313 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 282.6920ms
2023-06-22 17:16:10.956 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:16:11.237 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 281.3443ms
2023-06-22 17:16:22.145 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 91
2023-06-22 17:16:22.295 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:16:22.363 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:16:23.419 +03:00 [INF] Executed DbCommand (131ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:16:23.664 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 17:16:23.994 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 1620.7999ms
2023-06-22 17:16:23.998 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:16:24.096 +03:00 [ERR] Error when accessing the database.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ExpenseMaster.DAL.Repository.RepositoryWrapper.SaveAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.DAL\Repository\RepositoryWrapper.cs:line 88
   at ExpenseMaster.BusinessLogic.Implementations.ExpenseService.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\ExpenseService.cs:line 53
   at ExpenseMaster.Controllers.ExpenseController.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\ExpenseController.cs:line 39
   at lambda_method30(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:16:24.168 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 91 - 400 - - 2022.4454ms
2023-06-22 17:17:14.036 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 91
2023-06-22 17:17:14.043 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:17:14.044 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:17:14.099 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:17:14.104 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 17:17:14.244 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 198.2649ms
2023-06-22 17:17:14.247 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:17:14.331 +03:00 [ERR] Error when accessing the database.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ExpenseMaster.DAL.Repository.RepositoryWrapper.SaveAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.DAL\Repository\RepositoryWrapper.cs:line 88
   at ExpenseMaster.BusinessLogic.Implementations.ExpenseService.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\ExpenseService.cs:line 53
   at ExpenseMaster.Controllers.ExpenseController.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\ExpenseController.cs:line 39
   at lambda_method30(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:17:14.347 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 91 - 400 - - 310.5892ms
2023-06-22 17:17:25.345 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 89
2023-06-22 17:17:25.349 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:17:25.351 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:17:25.363 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:17:25.368 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Users_UserId". The conflict occurred in database "ExpenseMaster", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Users_UserId". The conflict occurred in database "ExpenseMaster", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 17:17:25.507 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 154.3306ms
2023-06-22 17:17:25.509 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:17:25.592 +03:00 [ERR] Error when accessing the database.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Expenses_Users_UserId". The conflict occurred in database "ExpenseMaster", table "dbo.Users", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:8f18c203-7a59-4f6d-95e6-c3b17dc81b63
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ExpenseMaster.DAL.Repository.RepositoryWrapper.SaveAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.DAL\Repository\RepositoryWrapper.cs:line 88
   at ExpenseMaster.BusinessLogic.Implementations.ExpenseService.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\ExpenseService.cs:line 53
   at ExpenseMaster.Controllers.ExpenseController.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\ExpenseController.cs:line 39
   at lambda_method30(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:17:25.604 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 89 - 400 - - 259.7429ms
2023-06-22 17:19:43.718 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 92
2023-06-22 17:19:43.723 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:19:43.725 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:19:43.730 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:20:03.930 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:20:03.940 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:20:35.938 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto'.
2023-06-22 17:20:38.439 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 54712.5335ms
2023-06-22 17:20:38.441 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:20:40.972 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 92 - 200 - application/json;+charset=utf-8 57254.1461ms
2023-06-22 17:21:01.052 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Income/user/1/total - -
2023-06-22 17:21:01.054 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster)'
2023-06-22 17:21:01.059 +03:00 [INF] Route matched with {action = "CalculateTotalIncomeByUserId", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalIncomeByUserId(Int32) on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:21:01.074 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:21:01.080 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:21:01.084 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster) in 20.4398ms
2023-06-22 17:21:01.085 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster)'
2023-06-22 17:21:01.086 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Income/user/1/total - - - 200 - application/json;+charset=utf-8 34.9116ms
2023-06-22 17:21:09.259 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/public/expenses/user/1/total - -
2023-06-22 17:21:09.261 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:21:09.266 +03:00 [INF] Route matched with {action = "CalculateTotalExpenseByUserId", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalExpenseByUserId(Int32) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:21:09.273 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:21:09.275 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:21:09.276 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster) in 7.2224ms
2023-06-22 17:21:09.279 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CalculateTotalExpenseByUserId (ExpenseMaster)'
2023-06-22 17:21:09.280 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/public/expenses/user/1/total - - - 200 - application/json;+charset=utf-8 21.2875ms
2023-06-22 17:24:55.970 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 93
2023-06-22 17:24:55.975 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:24:55.976 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:24:55.982 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:25:01.501 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:25:01.506 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:25:22.802 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[PasswordSalt], [u].[RoleId]
FROM [Users] AS [u]
WHERE [u].[Id] = @__userId_0
2023-06-22 17:26:33.561 +03:00 [INF] Executed DbCommand (58ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:26:33.771 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:26:33.778 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:26:33.887 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:26:34.224 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:26:34.226 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:26:34.230 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:26:34.231 +03:00 [INF] Hosting environment: Development
2023-06-22 17:26:34.232 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:26:34.925 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:26:35.447 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 531.6307ms
2023-06-22 17:26:35.887 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:26:35.888 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:26:35.903 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 15.1515ms
2023-06-22 17:26:35.944 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 53.6458ms
2023-06-22 17:26:36.511 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:26:36.856 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 345.6794ms
2023-06-22 17:27:46.260 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Auth/Registration application/json 78
2023-06-22 17:27:46.338 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 17:27:46.372 +03:00 [INF] Route matched with {action = "Create", controller = "Auth"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.IActionResult] Create(ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto) on controller ExpenseMaster.Controllers.AuthController (ExpenseMaster).
2023-06-22 17:27:46.724 +03:00 [INF] Executed DbCommand (44ms) [Parameters=[@__userRegistrationDto_Login_0='?' (Size = 20)], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Users] AS [u]
        WHERE [u].[Login] = @__userRegistrationDto_Login_0) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:27:47.002 +03:00 [INF] Executed DbCommand (28ms) [Parameters=[@p0='?' (Size = 30), @p1='?' (Size = 20), @p2='?' (Size = 8000) (DbType = Binary), @p3='?' (Size = 8000) (DbType = Binary), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Users] ([Email], [Login], [PasswordHash], [PasswordSalt], [RoleId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3, @p4);
2023-06-22 17:27:47.078 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.UserRegistrationDto'.
2023-06-22 17:27:47.095 +03:00 [INF] Executed action ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster) in 714.2647ms
2023-06-22 17:27:47.099 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.AuthController.Create (ExpenseMaster)'
2023-06-22 17:27:47.112 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Auth/Registration application/json 78 - 200 - application/json;+charset=utf-8 852.3581ms
2023-06-22 17:28:40.827 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Income application/json 92
2023-06-22 17:28:40.840 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:28:40.848 +03:00 [INF] Route matched with {action = "CreateIncome", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.IncomeItemDto]] CreateIncome(ExpenseMaster.BusinessLogic.Dto.IncomeDto) on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:28:40.946 +03:00 [INF] Executed DbCommand (7ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Incomes] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:28:40.988 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b4b7022e-0e09-4f2c-9067-2ea434d42822
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b4b7022e-0e09-4f2c-9067-2ea434d42822
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 17:28:41.156 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster) in 306.2813ms
2023-06-22 17:28:41.158 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:28:41.245 +03:00 [ERR] Error when accessing the database.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b4b7022e-0e09-4f2c-9067-2ea434d42822
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ExpenseMaster.DAL.Repository.RepositoryWrapper.SaveAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.DAL\Repository\RepositoryWrapper.cs:line 88
   at ExpenseMaster.BusinessLogic.Implementations.IncomeService.CreateIncome(IncomeDto incomeDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\IncomeService.cs:line 47
   at ExpenseMaster.Controllers.IncomeController.CreateIncome(IncomeDto incomeDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\IncomeController.cs:line 39
   at lambda_method129(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:28:41.290 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Income application/json 92 - 400 - - 464.4136ms
2023-06-22 17:28:54.137 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Income application/json 92
2023-06-22 17:28:54.146 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:28:54.148 +03:00 [INF] Route matched with {action = "CreateIncome", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.IncomeItemDto]] CreateIncome(ExpenseMaster.BusinessLogic.Dto.IncomeDto) on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:28:54.157 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Incomes] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:28:54.162 +03:00 [ERR] An exception occurred in the database while saving changes for context type 'ExpenseMaster.DAL.DatabaseContext.ApplicationDatabaseContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b4b7022e-0e09-4f2c-9067-2ea434d42822
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b4b7022e-0e09-4f2c-9067-2ea434d42822
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2023-06-22 17:28:54.295 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster) in 145.2568ms
2023-06-22 17:28:54.297 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:28:54.390 +03:00 [ERR] Error when accessing the database.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes. See the inner exception for details.
 ---> Microsoft.Data.SqlClient.SqlException (0x80131904): The INSERT statement conflicted with the FOREIGN KEY constraint "FK_Incomes_Categories_CategoryId". The conflict occurred in database "ExpenseMaster", table "dbo.Categories", column 'Id'.
   at Microsoft.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at Microsoft.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at Microsoft.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at Microsoft.Data.SqlClient.SqlDataReader.TryHasMoreRows(Boolean& moreRows)
   at Microsoft.Data.SqlClient.SqlDataReader.TryReadInternal(Boolean setTimeout, Boolean& more)
   at Microsoft.Data.SqlClient.SqlDataReader.ReadAsyncExecute(Task task, Object state)
   at Microsoft.Data.SqlClient.SqlDataReader.InvokeAsyncCall[T](SqlDataReaderAsyncCallContext`1 context)
--- End of stack trace from previous location ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeResultSetAsync(Int32 startCommandIndex, RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
ClientConnectionId:b4b7022e-0e09-4f2c-9067-2ea434d42822
Error Number:547,State:0,Class:16
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.AffectedCountModificationCommandBatch.ConsumeAsync(RelationalDataReader reader, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Update.Internal.SqlServerModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(IEnumerable`1 commandBatches, IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(StateManager stateManager, Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at ExpenseMaster.DAL.Repository.RepositoryWrapper.SaveAsync() in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.DAL\Repository\RepositoryWrapper.cs:line 88
   at ExpenseMaster.BusinessLogic.Implementations.IncomeService.CreateIncome(IncomeDto incomeDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\IncomeService.cs:line 47
   at ExpenseMaster.Controllers.IncomeController.CreateIncome(IncomeDto incomeDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\IncomeController.cs:line 39
   at lambda_method129(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:28:54.401 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Income application/json 92 - 400 - - 264.3671ms
2023-06-22 17:29:43.253 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:29:43.362 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:29:43.367 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:29:43.423 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:29:43.610 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:29:43.611 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:29:43.615 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:29:43.616 +03:00 [INF] Hosting environment: Development
2023-06-22 17:29:43.617 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:29:44.187 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:29:44.689 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 509.6640ms
2023-06-22 17:29:45.092 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:29:45.093 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:29:45.116 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 22.8199ms
2023-06-22 17:29:45.195 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 102.4088ms
2023-06-22 17:29:45.576 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:29:45.828 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 252.1032ms
2023-06-22 17:30:15.179 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Income application/json 96
2023-06-22 17:30:15.278 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Income application/json 96 - 200 0 - 98.9783ms
2023-06-22 17:30:40.854 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Income - -
2023-06-22 17:30:40.860 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Income - - - 200 0 - 6.6780ms
2023-06-22 17:30:59.856 +03:00 [INF] Executed DbCommand (73ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:31:00.123 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:31:00.129 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:31:00.195 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:31:00.454 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:31:00.455 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:31:00.474 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:31:00.477 +03:00 [INF] Hosting environment: Development
2023-06-22 17:31:00.478 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:31:01.334 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:31:02.156 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 828.5091ms
2023-06-22 17:31:02.770 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:31:02.770 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:31:02.793 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 22.9142ms
2023-06-22 17:31:02.876 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 106.6757ms
2023-06-22 17:31:03.472 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:31:03.712 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 239.5356ms
2023-06-22 17:31:15.582 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Income application/json 93
2023-06-22 17:31:15.727 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:31:15.787 +03:00 [INF] Route matched with {action = "CreateIncome", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.IncomeItemDto]] CreateIncome(ExpenseMaster.BusinessLogic.Dto.IncomeDto) on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:31:16.726 +03:00 [INF] Executed DbCommand (116ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Incomes] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:31:16.853 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.IncomeItemDto'.
2023-06-22 17:31:16.874 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster) in 1079.506ms
2023-06-22 17:31:16.877 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:31:16.897 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Income application/json 93 - 200 - application/json;+charset=utf-8 1315.7460ms
2023-06-22 17:31:21.862 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Income - -
2023-06-22 17:31:21.871 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.GetIncomes (ExpenseMaster)'
2023-06-22 17:31:21.878 +03:00 [INF] Route matched with {action = "GetIncomes", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Collections.Generic.IEnumerable`1[ExpenseMaster.BusinessLogic.Dto.IncomeItemDto]]] GetIncomes() on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:31:22.101 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [i].[Id], [i].[Amount], [i].[CategoryId], [i].[Date], [i].[UserId]
FROM [Incomes] AS [i]
2023-06-22 17:31:22.110 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Collections.Generic.List`1[[ExpenseMaster.BusinessLogic.Dto.IncomeItemDto, ExpenseMaster.BusinessLogic, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]]'.
2023-06-22 17:31:22.115 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.GetIncomes (ExpenseMaster) in 232.3421ms
2023-06-22 17:31:22.117 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.GetIncomes (ExpenseMaster)'
2023-06-22 17:31:22.120 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Income - - - 200 - application/json;+charset=utf-8 257.9316ms
2023-06-22 17:31:31.216 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/Income/user/6/total - -
2023-06-22 17:31:31.220 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster)'
2023-06-22 17:31:31.232 +03:00 [INF] Route matched with {action = "CalculateTotalIncomeByUserId", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[System.Decimal]] CalculateTotalIncomeByUserId(Int32) on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:31:31.346 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:31:31.351 +03:00 [INF] Executing OkObjectResult, writing value of type 'System.Decimal'.
2023-06-22 17:31:31.353 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster) in 116.5549ms
2023-06-22 17:31:31.354 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.CalculateTotalIncomeByUserId (ExpenseMaster)'
2023-06-22 17:31:31.355 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/Income/user/6/total - - - 200 - application/json;+charset=utf-8 139.8130ms
2023-06-22 17:32:14.808 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 93
2023-06-22 17:32:14.814 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:32:14.818 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:32:14.844 +03:00 [INF] Executed DbCommand (6ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:32:22.405 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:32:22.412 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:32:27.987 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[PasswordSalt], [u].[RoleId]
FROM [Users] AS [u]
WHERE [u].[Id] = @__userId_0
2023-06-22 17:34:53.524 +03:00 [INF] Executed DbCommand (33ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:34:53.625 +03:00 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:34:53.630 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:34:53.676 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:34:53.871 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:34:53.873 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:34:53.878 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:34:53.880 +03:00 [INF] Hosting environment: Development
2023-06-22 17:34:53.880 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:34:54.838 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:34:55.331 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 499.2256ms
2023-06-22 17:34:55.810 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:34:55.810 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:34:55.825 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 14.8709ms
2023-06-22 17:34:55.952 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 141.5260ms
2023-06-22 17:34:56.436 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:34:56.665 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 228.6410ms
2023-06-22 17:35:31.397 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/Income application/json 93
2023-06-22 17:35:31.502 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:35:31.534 +03:00 [INF] Route matched with {action = "CreateIncome", controller = "Income"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.IncomeItemDto]] CreateIncome(ExpenseMaster.BusinessLogic.Dto.IncomeDto) on controller ExpenseMaster.Controllers.IncomeController (ExpenseMaster).
2023-06-22 17:35:32.112 +03:00 [INF] Executed DbCommand (83ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Incomes] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:35:32.210 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.IncomeItemDto'.
2023-06-22 17:35:32.232 +03:00 [INF] Executed action ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster) in 689.3221ms
2023-06-22 17:35:32.235 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.IncomeController.CreateIncome (ExpenseMaster)'
2023-06-22 17:35:32.252 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/Income application/json 93 - 200 - application/json;+charset=utf-8 856.1115ms
2023-06-22 17:35:48.833 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 93
2023-06-22 17:35:48.835 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:35:48.841 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:35:48.927 +03:00 [INF] Executed DbCommand (14ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:36:02.705 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:36:02.714 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:36:18.871 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[PasswordSalt], [u].[RoleId]
FROM [Users] AS [u]
WHERE [u].[Id] = @__userId_0
2023-06-22 17:45:33.340 +03:00 [INF] Executed DbCommand (43ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:45:33.461 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:45:33.466 +03:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:45:33.517 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:45:33.716 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:45:33.717 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:45:33.721 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:45:33.722 +03:00 [INF] Hosting environment: Development
2023-06-22 17:45:33.723 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:45:34.766 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:45:35.306 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 546.2391ms
2023-06-22 17:45:35.794 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:45:35.795 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:45:35.827 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 21.5096ms
2023-06-22 17:45:35.931 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 137.1788ms
2023-06-22 17:45:36.516 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:45:36.979 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 463.6192ms
2023-06-22 17:46:56.172 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 93
2023-06-22 17:46:56.282 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:46:56.315 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:46:56.943 +03:00 [INF] Executed DbCommand (69ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:46:59.820 +03:00 [INF] Executed DbCommand (3ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:46:59.830 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:47:02.810 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[PasswordSalt], [u].[RoleId]
FROM [Users] AS [u]
WHERE [u].[Id] = @__userId_0
2023-06-22 17:47:08.126 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 11803.1022ms
2023-06-22 17:47:08.130 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:47:08.209 +03:00 [ERR] There was an error.
MailKit.Security.AuthenticationException: 535: 5.7.8 Username and Password not accepted. Learn more at
5.7.8  https://support.google.com/mail/?p=BadCredentials l17-20020a170906079100b00986f9c830efsm4723627ejc.156 - gsmtp
 ---> MailKit.Net.Smtp.SmtpCommandException: 5.7.8 Username and Password not accepted. Learn more at
5.7.8  https://support.google.com/mail/?p=BadCredentials l17-20020a170906079100b00986f9c830efsm4723627ejc.156 - gsmtp
   --- End of inner exception stack trace ---
   at MailKit.Net.Smtp.SmtpClient.AuthenticateAsync(Encoding encoding, ICredentials credentials, CancellationToken cancellationToken)
   at ExpenseMaster.BusinessLogic.Implementations.EmailService.SendEmailAsync(String email, Notification notification) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\EmailService.cs:line 40
   at ExpenseMaster.BusinessLogic.Implementations.NotificationService.SendExpenseExceededNotification(String userEmail) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\NotificationService.cs:line 20
   at ExpenseMaster.BusinessLogic.Implementations.ExpenseService.CheckExpenseExceeded(Int32 userId) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\ExpenseService.cs:line 74
   at ExpenseMaster.BusinessLogic.Implementations.ExpenseService.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster.BusinessLogic\Implementations\ExpenseService.cs:line 58
   at ExpenseMaster.Controllers.ExpenseController.CreateExpense(ExpenseDto expenseDto) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Controllers\ExpenseController.cs:line 39
   at lambda_method30(Closure , Object )
   at Microsoft.AspNetCore.Mvc.Infrastructure.ActionMethodExecutor.AwaitableObjectResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeActionMethodAsync>g__Awaited|12_0(ControllerActionInvoker invoker, ValueTask`1 actionResultValueTask)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeNextActionFilterAsync>g__Awaited|10_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Rethrow(ActionExecutedContextSealed context)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ControllerActionInvoker.<InvokeInnerFilterAsync>g__Awaited|13_0(ControllerActionInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeFilterPipelineAsync>g__Awaited|20_0(ResourceInvoker invoker, Task lastTask, State next, Scope scope, Object state, Boolean isCompleted)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Mvc.Infrastructure.ResourceInvoker.<InvokeAsync>g__Logged|17_1(ResourceInvoker invoker)
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.<Invoke>g__AwaitRequestTask|6_0(Endpoint endpoint, Task requestTask, ILogger logger)
   at ExpenseMaster.Middlewares.ExceptionHandlingMiddleware.Invoke(HttpContext context) in C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\Middlewares\ExceptionHandlingMiddleware.cs:line 20
2023-06-22 17:47:08.298 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 93 - 500 - - 12126.0358ms
2023-06-22 17:51:22.975 +03:00 [INF] Executed DbCommand (71ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Categories] AS [c]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:51:23.175 +03:00 [INF] Executed DbCommand (5ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Expenses] AS [e]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:51:23.183 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT CASE
    WHEN EXISTS (
        SELECT 1
        FROM [Incomes] AS [i]) THEN CAST(1 AS bit)
    ELSE CAST(0 AS bit)
END
2023-06-22 17:51:23.272 +03:00 [INF] User profile is available. Using 'C:\Users\stasd\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2023-06-22 17:51:23.572 +03:00 [INF] Now listening on: https://localhost:7124
2023-06-22 17:51:23.573 +03:00 [INF] Now listening on: http://localhost:5205
2023-06-22 17:51:23.580 +03:00 [INF] Application started. Press Ctrl+C to shut down.
2023-06-22 17:51:23.582 +03:00 [INF] Hosting environment: Development
2023-06-22 17:51:23.583 +03:00 [INF] Content root path: C:\Users\stasd\Git\ExpenseMaster\ExpenseMaster\
2023-06-22 17:51:24.496 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/index.html - -
2023-06-22 17:51:25.020 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/index.html - - - 200 - text/html;charset=utf-8 530.9234ms
2023-06-22 17:51:25.431 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_vs/browserLink - -
2023-06-22 17:51:25.431 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - -
2023-06-22 17:51:25.451 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_framework/aspnetcore-browser-refresh.js - - - 200 11996 application/javascript;+charset=utf-8 19.4504ms
2023-06-22 17:51:25.486 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/_vs/browserLink - - - 200 - text/javascript;+charset=UTF-8 54.8030ms
2023-06-22 17:51:25.918 +03:00 [INF] Request starting HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - -
2023-06-22 17:51:26.185 +03:00 [INF] Request finished HTTP/2 GET https://localhost:7124/swagger/v1/swagger.json - - - 200 - application/json;charset=utf-8 267.1311ms
2023-06-22 17:51:46.072 +03:00 [INF] Request starting HTTP/2 POST https://localhost:7124/public/expenses application/json 93
2023-06-22 17:51:46.162 +03:00 [INF] Executing endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:51:46.193 +03:00 [INF] Route matched with {action = "CreateExpense", controller = "Expense"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto]] CreateExpense(ExpenseMaster.BusinessLogic.Dto.ExpenseDto) on controller ExpenseMaster.Controllers.ExpenseController (ExpenseMaster).
2023-06-22 17:51:46.750 +03:00 [INF] Executed DbCommand (68ms) [Parameters=[@p0='?' (Precision = 10) (Scale = 2) (DbType = Decimal), @p1='?' (DbType = Int32), @p2='?' (DbType = Date), @p3='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET IMPLICIT_TRANSACTIONS OFF;
SET NOCOUNT ON;
INSERT INTO [Expenses] ([Amount], [CategoryId], [Date], [UserId])
OUTPUT INSERTED.[Id]
VALUES (@p0, @p1, @p2, @p3);
2023-06-22 17:51:49.575 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([e].[Amount]), 0.0)
FROM [Expenses] AS [e]
WHERE [e].[UserId] = @__userId_0
2023-06-22 17:51:49.585 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT COALESCE(SUM([i].[Amount]), 0.0)
FROM [Incomes] AS [i]
WHERE [i].[UserId] = @__userId_0
2023-06-22 17:51:51.410 +03:00 [INF] Executed DbCommand (2ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(1) [u].[Id], [u].[Email], [u].[Login], [u].[PasswordHash], [u].[PasswordSalt], [u].[RoleId]
FROM [Users] AS [u]
WHERE [u].[Id] = @__userId_0
2023-06-22 17:52:07.630 +03:00 [INF] Executing OkObjectResult, writing value of type 'ExpenseMaster.BusinessLogic.Dto.ExpenseItemDto'.
2023-06-22 17:52:09.677 +03:00 [INF] Executed action ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster) in 23475.7758ms
2023-06-22 17:52:09.681 +03:00 [INF] Executed endpoint 'ExpenseMaster.Controllers.ExpenseController.CreateExpense (ExpenseMaster)'
2023-06-22 17:52:10.754 +03:00 [INF] Request finished HTTP/2 POST https://localhost:7124/public/expenses application/json 93 - 200 - application/json;+charset=utf-8 24681.4011ms
